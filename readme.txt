TV番組表.alfredworkflowのメモ

機能：
現在放送中のTV番組を表示させ、選択した番組へチャンネルを切り替える

インストール：
　.alfredworkflowをダウンロード
　ファイルをダブルクリックしてワークフローに登録
　前提として、TVのリモコン with NatureRemo.workflow（ver1.1）のインストールが必要です
　https://github.com/KitanoTamotsu/natureremo

使い方：
　キーワード　tv

開発メモ：


1.TV番組の取得と表示

　TV王国のRSSを利用して放送中の番組を取得します
　このワークフローでは東京エリア地デジのRSSを利用していますので、適宜修正してください　

　Alfredの出力フォーマットへのセットですが、タイトルに番組名、サブタイトルに放送時間、引数にチャンネルとしてみました
　タイトルには結構記号が含まれており、おかしな振る舞いをするかもしれません
　そんなときには修正してくださいな
　ロジックでわかりにくいのは、下記の部分だけだと思います

　link=(1 ${link[@]})
　
　これは、配列の添字をあわせるためのコーティングで、
　このようにすると、配列のはじめの要素として"1"を追加できます


2.別のワークフローを呼び出す

　TVのチャンネル変更は、Lesson10で既に作成しているTVのリモコン with NatureRemoワークフローで実行させましょう
　そのためには、呼び出されるワークフローに入口を設定する必要があります

　TVのリモコンワークフローVer1.1の青い部分を追加しています
　Externalオブジェクトが入口になります
　IdentifierにChannelという名前をつけています

　さらにワークフロー自体のIDも必要です
　ワークフロー一覧でダブルクリックするとワークフローの概要が表示されますが、
　中央付近のBundle IDが、ワークフローのIDとなります
　com.alfredapp.kitanotamotsu.tv

　com.alfredapp.ユーザー名.ワークフロー名という感じが推奨れる表記ルールです
　一意であればなんでもOKです
　
　ここまで設定したら、呼び出す側のワークフローを作ります
  Call Externalオブジェクトを配置して、
  Workflow IDに、Bundle IDを、Trigger IDにIdentifierを記入すれば接続可能です

  またTVのリモコンワークフローのKeywordオブジェクトと、
　このワークフローのScript Filterオブジェクトのキーワドを一致させることでシームレスに使えます
  つまり、tvと入力するとScript Filterオブジェクトのリターンである番組表を表示しつつも
  tv ++で音量をあげるといった別ワークフローの機能も使えます（入力を受け付けます）

　なお、今回は別のワークフローを呼び出すサンプルとしてこのような形にしましたが、ひとつのワークフローでも可能です


3.エラーを通知させる

　呼び出すワークフローを少しだけ修正しました
　外から呼び出しようにしたので、その際発生したエラーを通知します
　引数として受け取ったチャンネルがcaseのどれにも該当しない場合、エラーとしています

　Post Notificationオブジェクトで{query}に何か入っている時だけ通知する機能があるので
　それを利用したのですが、1点誤算がありました
　正常なチャンネル変更として、CurlでNatureRemoのAPIをPOSTした際に、"{}"が引数となってしまうのです
　仕方なくRun Scriptオブジェクトでコントロールしましたが、ちょっと不恰好


背景：

　RSS関連のワークフローを作っている時に思いつきました
　そうだ、TV番組一覧から好きな番組を選んで、チャンネル変更すると便利かも
　思いついて、ちょっといじってみると、簡単にできてびっくりです
　なお、ワークフロー接続は、アップルスクリプトからの接続もできますし、そのワークフロー自身への接続も可能です
　Alfredってよくできてますね


